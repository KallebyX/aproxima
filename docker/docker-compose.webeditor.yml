version: '3.8'

services:
  aproxima:
    image: node:18-alpine
    container_name: aproxima
    restart: unless-stopped
    working_dir: /app
    ports:
      - "3010:3000"
    environment:
      - NODE_ENV=production
      - HOSTNAME=0.0.0.0
      - PORT=3000
    command: >
      sh -c "
        echo 'ðŸš€ Clonando repositÃ³rio...' &&
        apk add --no-cache git &&
        cd /tmp &&
        rm -rf aproxima 2>/dev/null || true &&
        git clone https://github.com/KallebyX/aproxima.git &&
        cd aproxima &&
        echo 'ðŸ“¦ Instalando dependÃªncias...' &&
        npm ci --ignore-scripts &&
        echo 'ðŸ”¨ Fazendo build...' &&
        npm run build &&
        echo 'âœ… Iniciando aplicaÃ§Ã£o...' &&
        cd /tmp/aproxima &&
        node .next/standalone/server.js
      "
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://127.0.0.1:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
